<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack打包优化 | Jamescain Blog</title>
    <meta name="description" content="A knowledge blog">
    <link rel="icon" href="/My-lab/favicon.ico">
    
    <link rel="preload" href="/My-lab/assets/css/styles.e689323a.css" as="style"><link rel="preload" href="/My-lab/assets/js/app.e689323a.js" as="script"><link rel="preload" href="/My-lab/assets/js/32.d8698e0e.js" as="script"><link rel="prefetch" href="/My-lab/assets/css/1.styles.b05fc641.css"><link rel="prefetch" href="/My-lab/assets/css/2.styles.a2bd3099.css"><link rel="prefetch" href="/My-lab/assets/js/1.b05fc641.js"><link rel="prefetch" href="/My-lab/assets/js/10.1733474b.js"><link rel="prefetch" href="/My-lab/assets/js/11.89ea83ca.js"><link rel="prefetch" href="/My-lab/assets/js/12.e022df96.js"><link rel="prefetch" href="/My-lab/assets/js/13.94526f52.js"><link rel="prefetch" href="/My-lab/assets/js/14.7df31e72.js"><link rel="prefetch" href="/My-lab/assets/js/15.d1b7129e.js"><link rel="prefetch" href="/My-lab/assets/js/16.a0280370.js"><link rel="prefetch" href="/My-lab/assets/js/17.f81a4d4c.js"><link rel="prefetch" href="/My-lab/assets/js/18.80ecd1c2.js"><link rel="prefetch" href="/My-lab/assets/js/19.249ddb74.js"><link rel="prefetch" href="/My-lab/assets/js/2.a2bd3099.js"><link rel="prefetch" href="/My-lab/assets/js/20.794d3e11.js"><link rel="prefetch" href="/My-lab/assets/js/21.dbea711f.js"><link rel="prefetch" href="/My-lab/assets/js/22.3091c34f.js"><link rel="prefetch" href="/My-lab/assets/js/23.c47e727f.js"><link rel="prefetch" href="/My-lab/assets/js/24.2f945c2c.js"><link rel="prefetch" href="/My-lab/assets/js/25.919977e7.js"><link rel="prefetch" href="/My-lab/assets/js/26.47fff9c3.js"><link rel="prefetch" href="/My-lab/assets/js/27.21a8f69f.js"><link rel="prefetch" href="/My-lab/assets/js/28.82500f23.js"><link rel="prefetch" href="/My-lab/assets/js/29.799dbfb7.js"><link rel="prefetch" href="/My-lab/assets/js/3.3a18354b.js"><link rel="prefetch" href="/My-lab/assets/js/30.d59e5bf4.js"><link rel="prefetch" href="/My-lab/assets/js/31.714fd27b.js"><link rel="prefetch" href="/My-lab/assets/js/33.e7942452.js"><link rel="prefetch" href="/My-lab/assets/js/4.13e7e4d8.js"><link rel="prefetch" href="/My-lab/assets/js/5.d37f1fd9.js"><link rel="prefetch" href="/My-lab/assets/js/6.3c9a61eb.js"><link rel="prefetch" href="/My-lab/assets/js/7.7b80c67e.js"><link rel="prefetch" href="/My-lab/assets/js/8.e6c1bf04.js"><link rel="prefetch" href="/My-lab/assets/js/9.b6b98d8d.js">
    <link rel="stylesheet" href="/My-lab/assets/css/1.styles.b05fc641.css"><link rel="stylesheet" href="/My-lab/assets/css/2.styles.a2bd3099.css"><link rel="stylesheet" href="/My-lab/assets/css/styles.e689323a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/My-lab/" class="home-link router-link-active"><!----> <span class="site-name">Jamescain Blog</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/My-lab/knowledge/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://twitter.com/Jamescain_lll" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/james-cain/My-lab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/My-lab/knowledge/" class="nav-link router-link-active">知识库</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://twitter.com/Jamescain_lll" target="_blank" rel="noopener noreferrer" class="nav-link external">
  作者twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/james-cain/My-lab" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>基础</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/My-lab/knowledge/Damn-hole-of-html5.html" class="sidebar-link">html5</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-CSS3.html" class="sidebar-link">CSS3</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/My-lab/knowledge/review-the-javascript.html" class="sidebar-link">ES6</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-http.html" class="sidebar-link">http/http2/https</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>进阶</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/My-lab/knowledge/Damn-hole-of-common-plugin.html" class="sidebar-link">常用插件包问题</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-Browser.html" class="sidebar-link">Browser</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-IE9.html" class="sidebar-link">IE9 兼容性</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-mobile-compatibility.html" class="sidebar-link">mobile 兼容性</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-google-devtools.html" class="sidebar-link">google devtools</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-network.html" class="sidebar-link">网络</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-safe-and-hacker.html" class="sidebar-link">网络安全</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-javascript-algonithms.html" class="sidebar-link">JavaScript算法</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-performance.html" class="sidebar-link">性能优化</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-the-EST.html" class="sidebar-link">EST</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-the-web-worker.html" class="sidebar-link">web-worker</a></li><li><a href="/My-lab/knowledge/parameters-of-package.html" class="sidebar-link">详解package.json</a></li><li><a href="/My-lab/knowledge/Advanced.html" class="sidebar-link">进阶学习</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>工具</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/My-lab/knowledge/Damn-hole-of-babel.html" class="sidebar-link">babel7</a></li><li><a href="/My-lab/knowledge/webpack-perf.html" class="active sidebar-link">Webpack打包优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/My-lab/knowledge/webpack-perf.html#初构webpack配置" class="sidebar-link">初构webpack配置</a></li><li class="sidebar-sub-header"><a href="/My-lab/knowledge/webpack-perf.html#优化之analyz" class="sidebar-link">优化之analyz</a></li><li class="sidebar-sub-header"><a href="/My-lab/knowledge/webpack-perf.html#优化之dllplugin" class="sidebar-link">优化之Dllplugin</a></li></ul></li><li><a href="/My-lab/knowledge/webpack-source-learning.html" class="sidebar-link">webpack源码</a></li><li><a href="/My-lab/knowledge/how-to-use-npm-sonatype.html" class="sidebar-link">用sonatype3搭建npm私服</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>拓展</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/My-lab/knowledge/Damn-hole-of-pwa.html" class="sidebar-link">PWA</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-electron.html" class="sidebar-link">electron</a></li><li><a href="/My-lab/knowledge/how-to-learn-ionic.html" class="sidebar-link">ionic</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>源码分析</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/My-lab/knowledge/Damn-hole-of-mvvm.html" class="sidebar-link">MVVM</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-React.html" class="sidebar-link">React</a></li><li><a href="/My-lab/knowledge/Damn-hole-of-Vue.html" class="sidebar-link">Vue</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/My-lab/knowledge/server-record.html" class="sidebar-link">部署一台属于自己的服务器</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="webpack打包优化"><a href="#webpack打包优化" aria-hidden="true" class="header-anchor">#</a> Webpack打包优化</h1> <p>前段花了时间阅读了部分的webpack的源码，意识到webpack对于前端开发的重要性，于是下定决心，以开发一个blog为例，记录我学习webpack打包优化的心得。</p> <p>当今打包工具众多，诸如<code>grunt</code>，<code>gulp</code>，<code>rollup</code>，<code>webpack</code>，<code>parcel</code>... webpack从中脱颖而出，各大框架基本都基于webpack做了自己的cli。本人开发技术栈为vue、react，之前一直都是使用官方scaffold，并没有花心思研究webpack，因为现在遇到了相关的需求，导致一发不可收拾。</p> <p>blog的webpack版本为：<code>4.11.1</code></p> <h2 id="初构webpack配置"><a href="#初构webpack配置" aria-hidden="true" class="header-anchor">#</a> 初构webpack配置</h2> <p>配置中引用的包如图</p> <p><img src="http://reyshieh.com/assets/webpack-configuration.png" alt="webpack-configuration"></p> <p><img src="http://reyshieh.com/assets/webpack-configuration2.png" alt="webpack-configuration2"></p> <p>配置<code>webpack.base.config.js</code></p> <div class="language- extra-class"><pre class="language-text"><code>const happyThreadPool = Happypack.ThreadPool({ size: os.cpus().length })
const createHappyPlugin = (id, loaders) =&gt; {
    return new Happypack({
        id,
        loaders,
        threadPool: happyThreadPool
    })
}
module: {
    rules: [
    {
        test: /\.js$/,
        loader: 'eslint-loader',
        exclude: /node_modules/
    },
    {
        enforce: 'pre',
        test: /\.vue$/,
        loader: 'eslint-loader',
        exclude: /node_modules/
    },
    {
        test: /\.js$/,
        loader: 'happypack/loader?id=happy-babel-js',
        exclude: '/node_modules/',
        include: [resolve('src')]
    },
    {
        test: /\.css$/,
        use: [
            env !== 'production' ? 'style-loader' : MiniCssExtractPlugin.loader,
            'css-loader'
        ]
    },
    {
        test: /\.less$/,
        use: [
            env !== 'production' ? 'style-loader' : MiniCssExtractPlugin.loader, // create style nodes from js string
            'css-loader', // translate css into commonjs
            'less-loader' // compile less to css
    	]
    },
    {
        test: /\.(png|jpe?g|gif|svg)(\?.*)?$/,
        loader: 'url-loader',
        options: {
            limit: 10000,
            name: 'img/[name].[hash:8].[ext]'
        }
    },
    {
        test: /\.(woff2?|eot|ttf|otf)(\?.*)?$/,
        loader: 'url-loader',
        options: {
            limit: 10000,
            name: 'fonts/[names].[hash:8].[ext]'
        }
    },
    {
        test: /\.md$/,
        loader: 'happypack/loader?id=happy-md',
        options: markdown
    },
    {
        test: /\.vue$/,
        loader: 'vue-loader',
        include: [resolve('src')],
        exclude: /node_modules/,
        options: {
            loaders: {
                css: [
                    env !== 'production' ? 'vue-style-loader' : MiniCssExtractPlugin.loader
                ],
                less: [
                    env !== 'production' ? 'vue-style-loader' : MiniCssExtractPlugin.loader,
                    'less-loader'
                ]
            }
    	}
    }
    ]
},
plugins: [
    new ProgressBarPlugin({
        format: '  build [:bar]' + chalk.green.bold(':percent') + ':elapsed seconds'
    }),
    // make sure to include the plugin for the magic
    new VueLoaderPlugin(),
    createHappyPlugin('happy-babel-js', ['babel-loader']),
    createHappyPlugin('happy-md', ['vue-markdown-loader']),
    // eslint-loader seem to try to access this.options which was removed.
    new webpack.LoaderOptionsPlugin({ options: {} })
],
resolve: {
    extensions: ['.vue', '.js', '.json'],
    modules: [
    	resolve('src'),
    	'node_modules'
    ],
    alias: {
        'vue$': 'vue/dist/vue.esm.js',
        '@': resolve('src')
    }
}
</code></pre></div><p>配置<code>webpack.dev.config.js</code></p> <div class="language- extra-class"><pre class="language-text"><code>mode: 'development',
entry: {
	app: './src/main.js'
},
output: {
    filename: 'js/[name].js',
    path: resolve('dist'),
    publicPath: '/'
},
devtool: '#cheap-module-eval-source-map',
devServer: {
    contentBase: resolve('/'),
    compress: true,
    hot: true,
    inline: true,
    publicPath: '/',
    port: '1574',
    stats: 'minimal',
    host: 'localhost'
},
plugins: [
    new webpack.optimize.ModuleConcatenationPlugin(),
    new webpack.HotModuleReplacementPlugin(),
    new webpack.NamedModulesPlugin(),
    new HtmlWebpackPlugin({
        filename: 'index.html',
        template: 'index.html',
        inject: true,
        chunks: ['app']
    })
]
</code></pre></div><p>配置<code>webpack.build.config.js</code></p> <div class="language- extra-class"><pre class="language-text"><code>mode: 'production',
// v1.0 vendor include vue/vue-router/vuex
entry: {
    'app': './src/main.js',
    'vendor': [
        'vue',
        'vue-router',
        'vuex'
    ]
},
output: {
    path: resolve('my-blog'),
    publicPath: '/my-blog/',
    filename: 'js/[name].[chunkhash:8].js',
    chunkFilename: 'js/[id].[chunhash:8].js'
},
// 用以下配置也行
// optimization: {
//     minimizer: [
//         new ParallelUglifyPlugin({
//             cache: true,
//             sourceMap: true
//         }),
//         new OptimizeCSSAssetsPlugin({})
//     ]
// },
plugins: [
    // scope hoisting(作用域提升)
    new webpack.optimize.ModuleConcatenationPlugin(),
    // extract css into its own file
    new MiniCssExtractPlugin({
    	filename: 'css/[name].[contenthash:8].css'
    }),
    // compress extracted css.
    new OptimizeCSSAssetsPlugin({}),
    new webpack.LoaderOptionsPlugin({
        minimize: true,
        debug: false
    }),
    // replace 'uglifyjs-webpack-plugin'
    new ParallelUglifyPlugin({
        cacheDir: '.cache/',
        uglifyJS: {
            output: {
                comments: false,
                beautify: false
            },
            compress: {
                warnings: false,
                drop_console: true,
                collapse_vars: true
            }
        }
    }),
    new HtmlWebpackPlugin({
        filename: 'index.html',
        template: 'index.html',
        inject: true,
        minify: {
            removeComments: true,
            collapseWhitespace: true,
            removeAttributeQuotes: true
        },
        chunks: ['vendor', 'app'],
        chunksSortMode: 'dependency'
    })
]
</code></pre></div><p>这个版本中，使用到<code>happypack</code>、<code>mini-css-extract-plugin</code>、<code>optimize-css-assets-plugin</code>、<code>webpack-parallel-uglify-plugin</code>、<code>ModuleConcatenationPlugin</code></p> <ul><li><p>happypack：定义happypack/loader?id=xx和创建Happypack({id}) plugin，用id关联。将原来的单进程loader执行，扩展为多进程模式，提高编译速度</p></li> <li><p>mini-css-extract-plugin：与extract-text-webpack-plugin相比，官方文档描述：</p> <ol><li>Async loading</li> <li>No duplicate compilation(performance)</li> <li>Easier to use</li> <li>Specific to CSS</li> <li>support HMR in the future</li></ol> <p>标配using preloaded or inlined CSS, Extracting all CSS in a single file, 还可以 extracting CSS based on entry, prevent the CSS duplication issue one  had with the ExtractTextPlugin(以后会试试)</p> <div class="language- extra-class"><pre class="language-text"><code>function recursiveIssuer(m) {
    if (m.issuer) {
        return recursiveIssuer(m.issuer)
    } else if (m.name) {
        return m.name
    } else {
        return false
    }
}
...
entry: {
    foo: resolve('src/foo'),
    bar: resolve('src/bar')
},
optimization: {
    splitChunks: {
        cacheGroups: {
            fooStyles: {
                name: 'foo',
                test: (m, c, entry='foo') =&gt; m.constructor.name === 'CssModule' &amp;&amp; recursiveIssuer(m) === entry,
                chunks: 'all',
                enforce: true
            },
            barStyles: {
                name: 'bar',
                test: (m, c, entry='bar') =&gt; m.constructor.name === 'CssModule' &amp;&amp; recursiveIssuer(m) === entry,
                chunks: 'all',
                enforce: true
            }
        }
    }
}
</code></pre></div></li> <li><p>optimize-css-assets-webpack-plugin：optimize/minimize the CSS，solve duplicate CSS.</p></li> <li><p>webpack-parallel-uglify-plugin：顾名思义，就是提升编译速度的升级版的webpack-uglify-plugin，功能一致。</p></li> <li><p>ModuleConcatenationPlugin：原先每个bundle都独立在一个闭包中，处理速度会减弱。webpack结合了rollup和closure Compiler将所有模块通过定义变量的方式提到一个闭包中，提升了代码的执行速度，俗称作用域提升(scope hoisting)。**注意：**使用作用域提升，必须要用ECMAScript模块语法（es6）。</p></li></ul> <h3 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h3> <p>在第一版中，使用了变量提升了编译后文件运行速度；使用了happypack、mini-css-extract-plugin、optimize-css-assets-webpack-plugin、webpack-parallel-uglify-plugin提升了编译速度。</p> <p>存在很大的问题，因为实际整个真实的代码就只有短短的几行，却打包出了vendor(122kb),app(96kb)。这是觉得不能忍的，缺少<code>externals</code>、<code>Dllplugin</code>、<code>DllReferencePlugin</code>、<code>Tree shaking</code>、<code>split chunks</code>、<code>dynamic import</code>，接下来要一一加上。</p> <p>上打包后的体积图</p> <p><img src="http://reyshieh.com/assets/webpack-version1.png" alt="webpack-version1"></p> <p>同时，由于是第一次搭webpack配置，还是碰到几个问题，顺带记录下</p> <ol><li><p><img src="http://reyshieh.com/assets/webpack-configuration-problem1.png" alt="webpack-configuration-problem1"></p> <p>原因：<a href="https://github.com/webpack/webpack/issues/6556" target="_blank" rel="noopener noreferrer">webpack升级到4.0后，已经将全局变量全部局部化，获取需要通过LoaderOptionsPlugin的方式定义全局变量才行，而eslint-loader还是采用原来的方式获取全局中的options，因此获取不到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><img src="http://reyshieh.com/assets/webpack-configuration-problem2.png" alt="webpack-configuration-problem2"></p> <p>原因：eslint升级到4.0.0以上后，eslint-plugin-html和eslint之间会有冲突，总之我是降版本解决，附上版本号</p> <p><img src="http://reyshieh.com/assets/webpack-configuration-solve2.png" alt="webpack-configuration-solve2"></p></li></ol> <h2 id="优化之analyz"><a href="#优化之analyz" aria-hidden="true" class="header-anchor">#</a> 优化之analyz</h2> <p>优化第一步，先用webpack-bundle-analyzer或者别的类似的功能插件做分析，第一版的分析结果如下</p> <p><img src="http://reyshieh.com/assets/webpack-performance-anlyz1.png" alt="webpack-performance-anlyz1"></p> <p>WTF，vue居然两边都打包了！先处理这个问题</p> <p>先把vendor中的vue、vue-router、vuex单独拆开，只是修改了entry的vendor和html-webpack-plugin中的引入模块</p> <p><img src="http://reyshieh.com/assets/webpack-performance-anlyz2.png" alt="webpack-performance-anlyz2"></p> <h2 id="优化之dllplugin"><a href="#优化之dllplugin" aria-hidden="true" class="header-anchor">#</a> 优化之Dllplugin</h2> <p>自webpack升级到v4以后，<code>CommonsChunkPlugin</code>被移除，官网推荐使用DllPlugin。DllPlugin就是升级版的CommonsChunkPlugin，但是解决了CommonsChunkPlugin带来的很多问题，例如，在打包时，都会给每个打包文件后缀加上hash，以至于每次那些基本不会发生变得的文件，一样会改变hash，这是发布中无法接受的。DllPlugin将vendor提取出来，通过单独打包，生成对应的manifest.json和vendor.dll.js。manifest.json用于在打build包时，检索bundle会和它的内部id比对，成功即不创建新的bundle，引用vendor.dll.js中的。下面列下配置：</p> <p>Webpack.dll.config.js</p> <div class="language- extra-class"><pre class="language-text"><code>mode: process.env.NODE_ENV === 'production' ? 'production' : 'development',
entry: {
    vendor: [
        'vue/dist/vue.min.js',
        'vue-router',
        'vuex'
    ]
},
output: {
    path: resolve('static/js'),
    filename: '[name].dll.js',
    library: '[name]_library'
},
module: {
    rules: [
        {
            test: /\.vue$/,
            loader: 'vue-loader'
        },
        {
            test: /\.js$/,
            loader: 'babel-loader',
            exclude: /node_modules/
        }
    ]
},
optimization: {
    minimizer: [
        new ParallelUglifyPlugin({
            cache: true,
            sourceMap: true
        }),
        new OptimizeCssAssetsPlugin({})
    ]
},
plugins: [
    new webpack.optimize.ModuleConcatenationPlugin(),
    new webpack.DllPlugin({
        path: resolve('webpack/[name]-manifest.json'),
        name: '[name]_library'
    })
]
</code></pre></div><p>Webpack.build.config.js</p> <div class="language- extra-class"><pre class="language-text"><code>new webpack.DllReferencePlugin({
    context: resolve(''),
    manifest: require('./vendor-manifest.json')
}),
</code></pre></div><p>打包结果：</p> <p><img src="http://reyshieh.com/assets/webpack-version1-3.png" alt="webpack-version1-3"></p> <p>分析结果</p> <p><img src="http://reyshieh.com/assets/webpack-performance-anlyz3.png" alt="webpack-performance-anlyz3"></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/My-lab/knowledge/Damn-hole-of-babel.html" class="prev">
          babel7
        </a></span> <span class="next"><a href="/My-lab/knowledge/webpack-source-learning.html">
          webpack源码
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/My-lab/assets/js/32.d8698e0e.js" defer></script><script src="/My-lab/assets/js/app.e689323a.js" defer></script>
  </body>
</html>
